package runner.contactlab.com;

import script.contactlab.com.ApplicationParameter;
import script.contactlab.com.ApplicationParameterHandler;

import com.google.inject.AbstractModule;
import com.google.inject.Guice;
import com.google.inject.Injector;
import com.mchange.v2.log.FallbackMLog;

public class App {	
    public static void main( String[] args ) throws Exception{
        
    	final Injector injector = Guice.createInjector(
			new AbstractModule() {
				
				@Override
				protected void configure() {					
					bind(ApplicationRunner.class).to(BruteForceApplicationRunner.class);
//					bind(ApplicationRunner.class).to(DelayedApplicationRunner.class);					
				}
			}
    	);
    	
    	//XXX 
    	// c3p0 non ha un log binded with slf4j ... !!?
    	// visto che di default usa l'impementazione jdk che stampa su sysout
    	// gli alzo il log level a WARNING
    	System.setProperty("com.mchange.v2.log.MLog", FallbackMLog.class.getCanonicalName());
    	System.setProperty("com.mchange.v2.log.FallbackMLog.DEFAULT_CUTOFF_LEVEL", "WARNING");    	    	       	    
    	
    	if (args.length == 0) {
    		injector.getInstance(ApplicationRunner.class).run();
    	} else if (args.length == 3) {
    		final ApplicationParameter params = new ApplicationParameter(new Integer(args[0]), args[1], args[2]);
    		
    		new ApplicationParameterHandler().check(params.getPathOfPayload());
    		
    		injector.getInstance(ApplicationRunner.class).run(params);
    	} else {
    		System.out.println("Execute with: numberOfThread databaseServer absolutePathOfPayload");
    		System.out.println(">java -jar mysql-stress-tool.jar 10 db1m-staging.contactlab.test /home/alan/Desktop/4");
    	}    	    	    
    }
       
}

/*

	Export with:
	
	> mvn compile assembly:single
	
	http://stackoverflow.com/questions/574594/how-can-i-create-an-executable-jar-with-dependencies-using-maven

*/
